<div class="modulo-form-container">
  <div class="container">
    <!-- Header -->
    <div class="form-header mb-5">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="form-title">
            <i class="fas fa-book me-3"></i>
            {{ isEditMode ? 'Editar Módulo' : 'Nuevo Módulo' }}
          </h1>
          <p class="form-subtitle">
            {{ isEditMode ? 'Modifica la información del módulo' : 'Completa el formulario para crear un nuevo módulo' }}
          </p>
        </div>
        <button class="btn btn-outline-secondary" (click)="cancelar()">
          <i class="fas fa-times me-2"></i>Cancelar
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3">Cargando información del módulo...</p>
    </div>

    <!-- Formulario -->
    <div *ngIf="!loading" class="row justify-content-center">
      <div class="col-lg-10">
        <!-- Error Message -->
        <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          {{ errorMessage }}
          <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
        </div>

        <!-- Form Card -->
        <div class="card shadow border-0">
          <div class="card-body p-4 p-md-5">
            <form [formGroup]="moduloForm" (ngSubmit)="onSubmit()" novalidate>
              <!-- Nombre -->
              <div class="row mb-4">
                <div class="col-md-12">
                  <label for="nombre" class="form-label">
                    <i class="fas fa-heading me-2"></i>Nombre del Módulo *
                  </label>
                  <input
                    type="text"
                    id="nombre"
                    formControlName="nombre"
                    class="form-control form-control-lg"
                    [class.is-invalid]="f['nombre'].invalid && f['nombre'].touched"
                    placeholder="Ej: Introducción a Angular 19"
                    maxlength="100"
                  >
                  <div *ngIf="f['nombre'].invalid && f['nombre'].touched" class="invalid-feedback">
                    <div *ngIf="f['nombre'].errors?.['required']">
                      El nombre es requerido
                    </div>
                    <div *ngIf="f['nombre'].errors?.['minlength']">
                      Mínimo 3 caracteres
                    </div>
                    <div *ngIf="f['nombre'].errors?.['maxlength']">
                      Máximo 100 caracteres
                    </div>
                  </div>
                  <div class="form-text text-end">
                    {{ f['nombre'].value?.length || 0 }}/100 caracteres
                  </div>
                </div>
              </div>

              <!-- Descripción -->
              <div class="row mb-4">
                <div class="col-md-12">
                  <label for="descripcion" class="form-label">
                    <i class="fas fa-align-left me-2"></i>Descripción *
                  </label>
                  <textarea
                    id="descripcion"
                    formControlName="descripcion"
                    class="form-control"
                    [class.is-invalid]="f['descripcion'].invalid && f['descripcion'].touched"
                    rows="4"
                    placeholder="Describe los objetivos y contenido principal del módulo..."
                    maxlength="500"
                  ></textarea>
                  <div *ngIf="f['descripcion'].invalid && f['descripcion'].touched" class="invalid-feedback">
                    <div *ngIf="f['descripcion'].errors?.['required']">
                      La descripción es requerida
                    </div>
                    <div *ngIf="f['descripcion'].errors?.['minlength']">
                      Mínimo 10 caracteres
                    </div>
                    <div *ngIf="f['descripcion'].errors?.['maxlength']">
                      Máximo 500 caracteres
                    </div>
                  </div>
                  <div class="form-text text-end">
                    {{ f['descripcion'].value?.length || 0 }}/500 caracteres
                  </div>
                </div>
              </div>

              <!-- Duración y Nivel -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <label for="duracionHoras" class="form-label">
                    <i class="fas fa-clock me-2"></i>Duración (horas) *
                  </label>
                  <div class="input-group">
                    <input
                      type="number"
                      id="duracionHoras"
                      formControlName="duracionHoras"
                      class="form-control"
                      [class.is-invalid]="f['duracionHoras'].invalid && f['duracionHoras'].touched"
                      min="1"
                      max="100"
                      step="1"
                    >
                    <span class="input-group-text">horas</span>
                  </div>
                  <div *ngIf="f['duracionHoras'].invalid && f['duracionHoras'].touched" class="invalid-feedback">
                    <div *ngIf="f['duracionHoras'].errors?.['required']">
                      La duración es requerida
                    </div>
                    <div *ngIf="f['duracionHoras'].errors?.['min']">
                      Mínimo 1 hora
                    </div>
                    <div *ngIf="f['duracionHoras'].errors?.['max']">
                      Máximo 100 horas
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="nivelDificultad" class="form-label">
                    <i class="fas fa-chart-line me-2"></i>Nivel de Dificultad *
                  </label>
                  <select
                    id="nivelDificultad"
                    formControlName="nivelDificultad"
                    class="form-select"
                    [class.is-invalid]="f['nivelDificultad'].invalid && f['nivelDificultad'].touched"
                  >
                    <option *ngFor="let nivel of nivelesDificultad" [value]="nivel.value">
                      {{ nivel.label }}
                    </option>
                  </select>
                  <div *ngIf="f['nivelDificultad'].invalid && f['nivelDificultad'].touched" class="invalid-feedback">
                    Selecciona un nivel de dificultad
                  </div>
                </div>
              </div>

              <!-- Contenido (Array) -->
              <div class="row mb-4">
                <div class="col-md-12">
                  <label class="form-label">
                    <i class="fas fa-list-ol me-2"></i>Contenido del Módulo *
                  </label>
                  <div class="contenido-container" formArrayName="contenido">
                    <div *ngFor="let item of contenido.controls; let i = index" class="mb-3">
                      <div class="input-group">
                        <span class="input-group-text">{{ i + 1 }}</span>
                        <input
                          type="text"
                          [formControlName]="i"
                          class="form-control"
                          [class.is-invalid]="item.invalid && item.touched"
                          placeholder="Ej: Introducción a los componentes"
                        >
                        <button
                          *ngIf="contenido.length > 1"
                          class="btn btn-outline-danger"
                          type="button"
                          (click)="eliminarContenido(i)"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                      <div *ngIf="item.invalid && item.touched" class="invalid-feedback d-block">
                        Este campo es requerido
                      </div>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm"
                    (click)="agregarContenido()"
                  >
                    <i class="fas fa-plus me-1"></i>Agregar tema
                  </button>
                  <div class="form-text">
                    Agrega los temas principales que cubrirá el módulo
                  </div>
                </div>
              </div>

              <!-- Instructor y Estado -->
              <div class="row mb-4">
                <div class="col-md-8">
                  <label for="instructor" class="form-label">
                    <i class="fas fa-user-tie me-2"></i>Instructor *
                  </label>
                  <input
                    type="text"
                    id="instructor"
                    formControlName="instructor"
                    class="form-control"
                    [class.is-invalid]="f['instructor'].invalid && f['instructor'].touched"
                    placeholder="Nombre del instructor"
                  >
                  <div *ngIf="f['instructor'].invalid && f['instructor'].touched" class="invalid-feedback">
                    <div *ngIf="f['instructor'].errors?.['required']">
                      El instructor es requerido
                    </div>
                    <div *ngIf="f['instructor'].errors?.['minlength']">
                      Mínimo 3 caracteres
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="form-label">
                    <i class="fas fa-toggle-on me-2"></i>Estado *
                  </label>
                  <div class="btn-group w-100" role="group">
                    <input
                      type="radio"
                      class="btn-check"
                      id="activo"
                      formControlName="estado"
                      value="activo"
                    >
                    <label class="btn btn-outline-success" for="activo">
                      <i class="fas fa-check me-1"></i>Activo
                    </label>

                    <input
                      type="radio"
                      class="btn-check"
                      id="inactivo"
                      formControlName="estado"
                      value="inactivo"
                    >
                    <label class="btn btn-outline-secondary" for="inactivo">
                      <i class="fas fa-times me-1"></i>Inactivo
                    </label>
                  </div>
                </div>
              </div>

              <!-- Botones de acción -->
              <div class="row mt-5">
                <div class="col-md-12">
                  <div class="d-flex justify-content-between">
                    <button
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="cancelar()"
                      [disabled]="submitting"
                    >
                      <i class="fas fa-arrow-left me-2"></i>Volver
                    </button>

                    <button
                      type="submit"
                      class="btn btn-primary px-5"
                      [disabled]="moduloForm.invalid || submitting"
                    >
                      <span *ngIf="!submitting; else loadingSpinner">
                        <i class="fas fa-save me-2"></i>
                        {{ isEditMode ? 'Actualizar' : 'Crear' }} Módulo
                      </span>
                      <ng-template #loadingSpinner>
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        {{ isEditMode ? 'Actualizando...' : 'Creando...' }}
                      </ng-template>
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Paleta de colores -->
        <div class="mt-4 text-center">
          <div class="color-palette-info">
            <small class="text-muted">
              <i class="fas fa-palette me-1"></i>
              Paleta Gustavo Leonardo:
              <span class="color-badge" style="background-color: #CCFF99;">#CCFF99</span>
              <span class="color-badge" style="background-color: #66CC33;">#66CC33</span>
              <span class="color-badge" style="background-color: #336600;">#336600</span>
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
